(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Show=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){},{}],2:[function(require,module,exports){"use strict";var hasOwn=Object.prototype.hasOwnProperty;var toStr=Object.prototype.toString;var isArray=function isArray(arr){if(typeof Array.isArray==="function"){return Array.isArray(arr)}return toStr.call(arr)==="[object Array]"};var isPlainObject=function isPlainObject(obj){if(!obj||toStr.call(obj)!=="[object Object]"){return false}var hasOwnConstructor=hasOwn.call(obj,"constructor");var hasIsPrototypeOf=obj.constructor&&obj.constructor.prototype&&hasOwn.call(obj.constructor.prototype,"isPrototypeOf");if(obj.constructor&&!hasOwnConstructor&&!hasIsPrototypeOf){return false}var key;for(key in obj){}return typeof key==="undefined"||hasOwn.call(obj,key)};module.exports=function extend(){var options,name,src,copy,copyIsArray,clone;var target=arguments[0];var i=1;var length=arguments.length;var deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(target==null||typeof target!=="object"&&typeof target!=="function"){target={}}for(;i<length;++i){options=arguments[i];if(options!=null){for(name in options){src=target[name];copy=options[name];if(target!==copy){if(deep&&copy&&(isPlainObject(copy)||(copyIsArray=isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&isArray(src)?src:[]}else{clone=src&&isPlainObject(src)?src:{}}target[name]=extend(deep,clone,copy)}else if(typeof copy!=="undefined"){target[name]=copy}}}}}return target}},{}],3:[function(require,module,exports){"use strict";module.exports=function(header){var result={"content-md5":"Content-MD5",dnt:"DNT",etag:"ETag","last-event-id":"Last-Event-ID",tcn:"TCN",te:"TE","www-authenticate":"WWW-Authenticate","x-dnsprefetch-control":"X-DNSPrefetch-Control"}[header.toLowerCase()];if(result){return result}return header.split("-").map(function(text){return text.charAt(0).toUpperCase()+text.substr(1).toLowerCase()}).join("-")}},{}],4:[function(require,module,exports){var has=Object.prototype.hasOwnProperty;var toString=Object.prototype.toString;function isEmpty(val){if(val==null)return true;if("boolean"==typeof val)return false;if("number"==typeof val)return val===0;if("string"==typeof val)return val.length===0;if("function"==typeof val)return val.length===0;if(Array.isArray(val))return val.length===0;if(val instanceof Error)return val.message==="";if(val.toString==toString){switch(val.toString()){case"[object File]":case"[object Map]":case"[object Set]":{return val.size===0}case"[object Object]":{for(var key in val){if(has.call(val,key))return false}return true}}}return false}module.exports=isEmpty},{}],5:[function(require,module,exports){"use strict";function _interopDefault(ex){return ex&&typeof ex==="object"&&"default"in ex?ex["default"]:ex}var lie=_interopDefault(require("lie"));var PouchPromise=typeof Promise==="function"?Promise:lie;module.exports=PouchPromise},{lie:7}],6:[function(require,module,exports){(function(global){"use strict";var Mutation=global.MutationObserver||global.WebKitMutationObserver;var scheduleDrain;{if(Mutation){var called=0;var observer=new Mutation(nextTick);var element=global.document.createTextNode("");observer.observe(element,{characterData:true});scheduleDrain=function(){element.data=called=++called%2}}else if(!global.setImmediate&&typeof global.MessageChannel!=="undefined"){var channel=new global.MessageChannel;channel.port1.onmessage=nextTick;scheduleDrain=function(){channel.port2.postMessage(0)}}else if("document"in global&&"onreadystatechange"in global.document.createElement("script")){scheduleDrain=function(){var scriptEl=global.document.createElement("script");scriptEl.onreadystatechange=function(){nextTick();scriptEl.onreadystatechange=null;scriptEl.parentNode.removeChild(scriptEl);scriptEl=null};global.document.documentElement.appendChild(scriptEl)}}else{scheduleDrain=function(){setTimeout(nextTick,0)}}}var draining;var queue=[];function nextTick(){draining=true;var i,oldQueue;var len=queue.length;while(len){oldQueue=queue;queue=[];i=-1;while(++i<len){oldQueue[i]()}len=queue.length}draining=false}module.exports=immediate;function immediate(task){if(queue.push(task)===1&&!draining){scheduleDrain()}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],7:[function(require,module,exports){"use strict";var immediate=require("immediate");function INTERNAL(){}var handlers={};var REJECTED=["REJECTED"];var FULFILLED=["FULFILLED"];var PENDING=["PENDING"];module.exports=Promise;function Promise(resolver){if(typeof resolver!=="function"){throw new TypeError("resolver must be a function")}this.state=PENDING;this.queue=[];this.outcome=void 0;if(resolver!==INTERNAL){safelyResolveThenable(this,resolver)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){if(typeof onFulfilled!=="function"&&this.state===FULFILLED||typeof onRejected!=="function"&&this.state===REJECTED){return this}var promise=new this.constructor(INTERNAL);if(this.state!==PENDING){var resolver=this.state===FULFILLED?onFulfilled:onRejected;unwrap(promise,resolver,this.outcome)}else{this.queue.push(new QueueItem(promise,onFulfilled,onRejected))}return promise};function QueueItem(promise,onFulfilled,onRejected){this.promise=promise;if(typeof onFulfilled==="function"){this.onFulfilled=onFulfilled;this.callFulfilled=this.otherCallFulfilled}if(typeof onRejected==="function"){this.onRejected=onRejected;this.callRejected=this.otherCallRejected}}QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value)};QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value)};QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value)};QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value)};function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value)}catch(e){return handlers.reject(promise,e)}if(returnValue===promise){handlers.reject(promise,new TypeError("Cannot resolve promise with itself"))}else{handlers.resolve(promise,returnValue)}})}handlers.resolve=function(self,value){var result=tryCatch(getThen,value);if(result.status==="error"){return handlers.reject(self,result.value)}var thenable=result.value;if(thenable){safelyResolveThenable(self,thenable)}else{self.state=FULFILLED;self.outcome=value;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callFulfilled(value)}}return self};handlers.reject=function(self,error){self.state=REJECTED;self.outcome=error;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callRejected(error)}return self};function getThen(obj){var then=obj&&obj.then;if(obj&&(typeof obj==="object"||typeof obj==="function")&&typeof then==="function"){return function appyThen(){then.apply(obj,arguments)}}}function safelyResolveThenable(self,thenable){var called=false;function onError(value){if(called){return}called=true;handlers.reject(self,value)}function onSuccess(value){if(called){return}called=true;handlers.resolve(self,value)}function tryToUnwrap(){thenable(onSuccess,onError)}var result=tryCatch(tryToUnwrap);if(result.status==="error"){onError(result.value)}}function tryCatch(func,value){var out={};try{out.value=func(value);out.status="success"}catch(e){out.status="error";out.value=e}return out}Promise.resolve=resolve;function resolve(value){if(value instanceof this){return value}return handlers.resolve(new this(INTERNAL),value)}Promise.reject=reject;function reject(reason){var promise=new this(INTERNAL);return handlers.reject(promise,reason)}Promise.all=all;function all(iterable){var self=this;if(Object.prototype.toString.call(iterable)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var len=iterable.length;var called=false;if(!len){return this.resolve([])}var values=new Array(len);var resolved=0;var i=-1;var promise=new this(INTERNAL);while(++i<len){allResolver(iterable[i],i)}return promise;function allResolver(value,i){self.resolve(value).then(resolveFromAll,function(error){if(!called){called=true;handlers.reject(promise,error)}});function resolveFromAll(outValue){values[i]=outValue;if(++resolved===len&&!called){called=true;handlers.resolve(promise,values)}}}}Promise.race=race;function race(iterable){var self=this;if(Object.prototype.toString.call(iterable)!=="[object Array]"){return this.reject(new TypeError("must be an array"))}var len=iterable.length;var called=false;if(!len){return this.resolve([])}var i=-1;var promise=new this(INTERNAL);while(++i<len){resolver(iterable[i])}return promise;function resolver(value){self.resolve(value).then(function(response){if(!called){called=true;handlers.resolve(promise,response)}},function(error){if(!called){called=true;handlers.reject(promise,error)}})}}},{immediate:6}],8:[function(require,module,exports){"use strict";module.exports=function nodify(promise,callback){if(typeof callback==="function"){promise.then(function(resp){callback(null,resp)},function(err){callback(err,null)})}}},{}],9:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],10:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],11:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":9,"./encode":10}],12:[function(require,module,exports){module.exports=function(){var d=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=="x"?r:r&3|8).toString(16)})}},{}],13:[function(require,module,exports){"use strict";var PouchPluginError=require("pouchdb-plugin-error");var extend=require("extend");exports.evaluate=function(requireContext,extraVars,program){var require;if(requireContext){require=function(libPath){var requireLocals=extend({module:{id:libPath,current:undefined,parent:undefined,exports:{}}},locals);requireLocals.exports=requireLocals.module.exports;var path=libPath.split("/");var lib=requireContext;for(var i=0;i<path.length;i+=1){lib=lib[path[i]]}lib+="\nreturn module.exports;";return evalProgram(lib,requireLocals)}}program=program.replace(/;\s*$/,"");var locals=extend({isArray:isArray,toJSON:toJSON,log:log,sum:sum,require:require},extraVars);var func;try{func=evalProgram("return "+program,locals);if(typeof func!=="function"){throw"no function"}}catch(e){throw new PouchPluginError({name:"compilation_error",status:500,message:"Expression does not eval to a function. "+program})}return func};var isArray=Array.isArray;var toJSON=JSON.stringify;var log=function(message){if(typeof message!="string"){message=JSON.stringify(message)}console.log("EVALUATED FUNCTION LOGS: "+message)};var sum=function(array){return array.reduce(function(a,b){return a+b})};function evalProgram(program,locals){var keys=Object.keys(locals);var values=keys.map(function(key){return locals[key]});var code="(function ("+keys.join(", ")+") {"+program+"})";return eval(code).apply(null,values)}exports.wrapExecutionError=function(e){return new PouchPluginError({name:e.name,message:e.toString()+"\n\n"+e.stack,status:500})}},{extend:2,"pouchdb-plugin-error":19}],14:[function(require,module,exports){(function(global){"use strict";var extend=require("extend");var isEmpty=require("is-empty");var querystring=require("querystring");var Promise=require("pouchdb-promise");var uuid=require("random-uuid-v4");var buildUserContextObject=require("./couchusercontextobject.js");var normalizeHeaderCase=require("header-case-normalizer");module.exports=function buildRequestObject(db,pathEnd,options){var infoPromise=db.info();var pathPromise=infoPromise.then(function(info){pathEnd.unshift(encodeURIComponent(info.db_name));return normalizePath(pathEnd)});var userCtxPromise=infoPromise.then(buildUserContextObject);return Promise.all([pathPromise,infoPromise,userCtxPromise]).then(function(args){args.push(getHost(db));args.push(uuid());args.push(options);return actuallyBuildRequestObject.apply(null,args)})};function getHost(db){try{var url=decodeURI(db.getUrl());return url.split("://")[1].split("/")[0].split("@").pop()}catch(err){return"localhost:5984"}}function normalizePath(path){var up=0;for(var i=path.length-1;i>=0;i--){var last=path[i];if(last==="."){path.splice(i,1)}else if(last===".."){path.splice(i,1);up++}else if(up){path.splice(i,1);up--}}for(;up--;up){path.unshift("..")}return path}function actuallyBuildRequestObject(path,info,userCtx,host,uuid,options){var result={body:"undefined",cookie:{},form:{},headers:{Host:host,Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":buildAcceptLanguage(),"User-Agent":buildUserAgent()},info:info,method:"GET",path:path.slice(0),peer:"127.0.0.1",query:{},requested_path:path.slice(0),raw_path:"/"+path.join("/"),secObj:{},userCtx:userCtx,uuid:uuid};if(["_show","_update"].indexOf(path[3])===-1){result.id=null}else{result.id=path[5]||null;if(result.id==="_design"&&path[6]){result.id+="/"+path[6]}}if(options&&options.headers){Object.keys(options.headers).forEach(function(header){if(["x-couchdb-requested-path"].indexOf(header)===-1){result.headers[normalizeHeaderCase(header)]=options.headers[header]}else{result.headers[header]=options.headers[header]}});delete options.headers}extend(true,result,options);if(options.path){result.path=options.path}if(options.requested_path){result.requested_path=options.requested_path}var i=result.requested_path.length-1;var pathEnd=result.requested_path[i];if(!isEmpty(result.query)&&pathEnd.indexOf("?")===-1){result.requested_path[i]=pathEnd+"?"+querystring.stringify(result.query)}if(!isEmpty(result.query)&&result.raw_path.indexOf("?")===-1){result.raw_path+="?"+querystring.stringify(result.query)}if(!isEmpty(result.form)&&result.body==="undefined"){result.body=querystring.stringify(result.form);result.headers["Content-Type"]="application/x-www-form-urlencoded";result.headers["Content-Length"]=result.body.length.toString()}if(result.body!=="undefined"&&["POST","PUT","PATCH"].indexOf(result.method)===-1){result.method="POST"}return result}function buildAcceptLanguage(){var lang=(global.navigator||{}).language||(global.navigator||{}).userLanguage;lang=(lang||"en").toLowerCase();if(["en","en-us"].indexOf(lang)!==-1){return"en-us,en;q=0.5"}else{return lang+",en-us;q=0.7,en;q=0.3"}}function buildUserAgent(){var ua=(global.navigator||{}).userAgent;return ua||"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:28.0) Gecko/20100101 Firefox/28.0"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./couchusercontextobject.js":15,extend:2,"header-case-normalizer":3,"is-empty":4,"pouchdb-promise":5,querystring:11,"random-uuid-v4":12}],15:[function(require,module,exports){"use strict";module.exports=function buildUserContextObject(info){return{db:info.db_name,name:null,roles:["_admin"]}}},{}],16:[function(require,module,exports){"use strict";exports.buildUserContextObject=require("./couchusercontextobject.js");exports.buildRequestObject=require("./couchrequestobject.js")},{"./couchrequestobject.js":14,"./couchusercontextobject.js":15}],17:[function(require,module,exports){"use strict";var extend=require("extend");var isEmpty=require("is-empty");var coucheval=require("couchdb-eval");var completeRespObj=require("couchdb-resp-completer");var PouchPluginError=require("pouchdb-plugin-error");function isObject(value){return Object.prototype.toString.call(value)==="[object Object]"}module.exports=function render(source,designDoc,data,req,extraVars){if(!extraVars){extraVars={}}var providesCtx=buildProvidesCtx();extend(extraVars,providesCtx.api);var func=coucheval.evaluate(designDoc,extraVars,source);var result,contentType;try{result=func.call(designDoc,data,req)}catch(e){throw coucheval.wrapExecutionError(e)}if(!(typeof result==="string"||isObject(result))){var resp=providesCtx.getResult(req);result=resp[0];contentType=resp[1]}return completeRespObj(result,contentType)};function buildProvidesCtx(){var providesFuncs={};var types=[];function registerType(key){var mimes=Array.prototype.slice.call(arguments,1);types.push([key,mimes])}registerType("all","*/*");registerType("text","text/plain; charset=utf-8","txt");registerType("html","text/html; charset=utf-8");registerType("xhtml","application/xhtml+xml","xhtml");registerType("xml","application/xml","text/xml","application/x-xml");registerType("js","text/javascript","application/javascript","application/x-javascript");registerType("css","text/css");registerType("ics","text/calendar");registerType("csv","text/csv");registerType("rss","application/rss+xml");registerType("atom","application/atom+xml");registerType("yaml","application/x-yaml","text/yaml");registerType("multipart_form","multipart/form-data");registerType("url_encoded_form","application/x-www-form-urlencoded");registerType("json","application/json","text/x-json");function execute(type){try{return providesFuncs[type]()}catch(e){throw coucheval.wrapExecutionError(e)}}function getRelevantTypes(){return types.filter(function(type){return providesFuncs.hasOwnProperty(type[0])})}function contentTypeFor(searchedType){for(var i=0;i<types.length;i+=1){if(types[i][0]===searchedType){return types[i][1][0]}}}function bestMatchForAcceptHeader(header){var requestedMimes=parseAcceptHeader(header);var relevantTypes=getRelevantTypes();for(var i=0;i<requestedMimes.length;i+=1){var requestedMime=requestedMimes[i];var requestedParts=requestedMime.split(";")[0].trim().split("/");for(var j=0;j<relevantTypes.length;j+=1){var type=relevantTypes[j][0];var mimes=relevantTypes[j][1];for(var k=0;k<mimes.length;k+=1){var mime=mimes[k];var availableParts=mime.split(";")[0].trim().split("/");var match=(requestedParts[0]===availableParts[0]||requestedParts[0]==="*"||availableParts[0]==="*")&&(requestedParts[1]===availableParts[1]||requestedParts[1]==="*"||availableParts[1]==="*");if(match){return[type,mime]}}}}throw new PouchPluginError({status:406,name:"not_acceptable",message:["Content-Type(s)",requestedMimes.join(", "),"not supported, try one of:",Object.keys(providesFuncs).map(contentTypeFor)].join(" ")})}function provides(type,func){providesFuncs[type]=func}function getResult(req){if(isEmpty(providesFuncs)){return[""]}if(req.query.format){if(!providesFuncs.hasOwnProperty(req.query.format)){throw new PouchPluginError({status:500,name:"render_error",message:["the format option is set to '",req.query.format,"'"+", but there's no provider registered for that format."].join("")})}return[execute(req.query.format),contentTypeFor(req.query.format)]}var chosenType=bestMatchForAcceptHeader(req.headers.Accept);return[execute(chosenType[0]),chosenType[1]]}return{api:{provides:provides,registerType:registerType},getResult:getResult}}function parseAcceptHeader(header){return header.split(",").map(function(part){return part.split(";")[0].trim()})}},{"couchdb-eval":13,"couchdb-resp-completer":18,extend:2,"is-empty":4,"pouchdb-plugin-error":19}],18:[function(require,module,exports){"use strict";var extend=require("extend");var isEmpty=require("is-empty");var PouchPluginError=require("pouchdb-plugin-error");module.exports=function completeRespObj(resp,contentType){if(typeof resp==="string"){resp={body:resp}}if(Object.prototype.toString.call(resp)!=="[object Object]"){resp={}}var copy=extend({},resp);delete copy.code;delete copy.json;delete copy.body;delete copy.base64;delete copy.headers;delete copy.stop;if(!isEmpty(copy)){var key=Object.keys(copy)[0];throw new PouchPluginError({status:500,name:"external_response_error",message:["Invalid data from external server: {<<",JSON.stringify(key),">>,<<",JSON.stringify(copy[key]),">>}"].join("")})}resp.code=resp.code||200;resp.headers=resp.headers||{};resp.headers.Vary=resp.headers.Vary||"Accept";resp.headers["Content-Type"]=resp.headers["Content-Type"]||contentType;if(typeof resp.json!=="undefined"){resp.body=JSON.stringify(resp.json);resp.headers["Content-Type"]=resp.headers["Content-Type"]||"application/json"}if(typeof resp.base64!=="undefined"){resp.headers["Content-Type"]=resp.headers["Content-Type"]||"application/binary"}resp.headers["Content-Type"]=resp.headers["Content-Type"]||"text/html; charset=utf-8";delete resp.headers.Etag;if(typeof resp.body==="undefined"&&typeof resp.base64==="undefined"){resp.body=""}return resp}},{extend:2,"is-empty":4,"pouchdb-plugin-error":19}],19:[function(require,module,exports){"use strict";function PouchPluginError(opts){this.status=opts.status;this.name=opts.name;this.message=opts.message;this.error=true;this.stack=(new Error).stack}PouchPluginError.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})};module.exports=PouchPluginError},{}],20:[function(require,module,exports){(function(global){"use strict";var Promise=require("pouchdb-promise");var PouchPluginError=require("pouchdb-plugin-error");var normalizeHeaderCase=require("header-case-normalizer");var extend=require("extend");if(typeof global.XMLHttpRequest==="undefined"){global.XMLHttpRequest=require("xmlhttprequest-cookie").XMLHttpRequest}module.exports=function httpQuery(db,req){return new Promise(function(resolve,reject){function callback(){if(xhr.readyState!==4){return}if(xhr.status<200||xhr.status>=300){try{var err=JSON.parse(xhr.responseText);reject(new PouchPluginError({name:err.error,message:err.reason,status:xhr.status}))}catch(err){reject(new PouchPluginError({name:"unknown_error",message:xhr.responseText,status:500}))}return}var headers={};xhr.getAllResponseHeaders().split("\r\n").forEach(function(line){if(line){var splittedHeader=line.split(":");headers[normalizeHeaderCase(splittedHeader[0]).trim()]=splittedHeader[1].trim()}});var result={body:xhr.responseText,headers:headers,code:xhr.status};if(headers["content-type"]==="application/json"){result.json=JSON.parse(result.body)}resolve(result)}var url=db.name.replace(/\/[^\/]+\/?$/,"")+req.raw_path;var pouchHeaders=(db.getHeaders||fakeGetHeaders)();var headers=extend({},pouchHeaders,req.headers);var xhr=new XMLHttpRequest;xhr.withCredentials=true;xhr.onreadystatechange=callback;xhr.open(req.method,url,true);for(var name in headers){if(headers.hasOwnProperty(name)){if(xhr.setDisableHeaderCheck){xhr.setDisableHeaderCheck(true)}xhr.setRequestHeader(name,headers[name])}}xhr.send(req.body==="undefined"?null:req.body)})};function fakeGetHeaders(){return{}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{extend:2,"header-case-normalizer":3,"pouchdb-plugin-error":19,"pouchdb-promise":5,"xmlhttprequest-cookie":1}],21:[function(require,module,exports){"use strict";var couchdb_objects=require("couchdb-objects");var render=require("couchdb-render");var nodify=require("promise-nodify");var httpQuery=require("pouchdb-req-http-query");var PouchPluginError=require("pouchdb-plugin-error");var Promise=require("pouchdb-promise");exports.show=function(showPath,options,callback){if(["function","undefined"].indexOf(typeof options)!==-1){callback=options;options={}}var db=this;var splitted=showPath.split("/");var designDocName=splitted[0];var showName=splitted[1];var docId=splitted.slice(2).join("/");var pathEnd=["_design",designDocName,"_show",showName];if(docId){pathEnd.push.apply(pathEnd,docId.split("/"))}var reqPromise=couchdb_objects.buildRequestObject(db,pathEnd,options);var promise=reqPromise.then(function(req){if(["http","https"].indexOf(db.type())===-1){return offlineQuery(db,designDocName,showName,docId,req,options)}else{return httpQuery(db,req)}});nodify(promise,callback);return promise};function offlineQuery(db,designDocName,showName,docId,req,options){var ddocPromise=db.get("_design/"+designDocName).then(function(designDoc){if(!(designDoc.shows||{}).hasOwnProperty(showName)){throw new PouchPluginError({status:404,name:"not_found",message:"missing show function "+showName+" on design doc _design/"+designDocName})}return designDoc});var docPromise=db.get(docId,options).catch(function(){return null});var doc;return Promise.all([ddocPromise,docPromise]).then(Function.prototype.apply.bind(function(designDoc,theDoc){doc=theDoc;var source=designDoc.shows[showName];return render(source,designDoc,doc,req)},null)).catch(function(err){if(doc===null&&req.path.length>5){throw new PouchPluginError({status:404,name:"not_found",message:"document not found"})}throw err})}},{"couchdb-objects":16,"couchdb-render":17,"pouchdb-plugin-error":19,"pouchdb-promise":5,"pouchdb-req-http-query":20,"promise-nodify":8}]},{},[21])(21)});